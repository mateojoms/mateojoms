<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Village Enterprise IT Tips</title>
  <style>
    /* ===== CSS Variables ===== */
    /*
  CSS file for Village Enterprise theme styling
  
  This file contains all the styling rules for the IT tips web application.
  It includes Village Enterprise brand colors, typography, and layout styles.
*/

/* ===== CSS Variables ===== */
:root {
    /* Village Enterprise Inspired Color Palette */
    --primary-color: #1a365d;        /* Deep professional blue */
    --secondary-color: #2b77e6;      /* Trustworthy blue */
    --accent-color: #059669;         /* Growth/sustainability green */
    --success-color: #10b981;        /* Lighter green for positive actions */
    --text-color: #1f2937;           /* Dark gray for excellent readability */
    --text-light: #6b7280;           /* Medium gray for secondary text */
    --text-muted: #9ca3af;           /* Light gray for muted text */
    --bg-color: #f8fafc;             /* Very light blue-gray background */
    --surface-color: #ffffff;        /* Pure white for cards */
    --border-color: #e5e7eb;         /* Subtle borders */
    --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
    --shadow-hover: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
    --border-radius: 12px;
    --border-radius-sm: 8px;
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 0.75rem;
    --spacing-lg: 1rem;
    --spacing-xl: 1.5rem;
    --spacing-2xl: 2rem;
    --spacing-3xl: 3rem;
}

/* ===== Reset & Base Styles ===== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Inter', sans-serif;
    line-height: 1.6;
    color: var(--text-color);
    background: linear-gradient(135deg, var(--bg-color) 0%, #f1f5f9 100%);
    background-attachment: fixed;
    padding: var(--spacing-xl);
    min-height: 100vh;
}

/* ===== Header Styles ===== */
header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: var(--spacing-3xl) var(--spacing-2xl);
    border-radius: var(--border-radius);
    margin-bottom: var(--spacing-2xl);
    text-align: center;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
}

header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.08)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.1;
}

header h1 {
    font-size: 2.25rem;
    margin-bottom: var(--spacing-md);
    font-weight: 700;
    letter-spacing: -0.025em;
    position: relative;
    z-index: 1;
}

header .description {
    font-size: 1.125rem;
    opacity: 0.95;
    font-weight: 400;
    max-width: 600px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

/* ===== Filter Section Styles ===== */
.filters {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-xl);
}

.search-container,
.filter-container {
    width: 100%;
}

.search-container input[type="search"] {
    width: 100%;
    padding: var(--spacing-lg);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    font-size: 1rem;
    background-color: var(--surface-color);
    color: var(--text-color);
    transition: all 0.3s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.search-container input[type="search"]:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1), 0 1px 3px rgba(0, 0, 0, 0.1);
}

.filter-container label {
    display: block;
    margin-bottom: var(--spacing-sm);
    font-weight: 500;
    color: var(--text-color);
}

.filter-container select {
    width: 100%;
    padding: var(--spacing-lg);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    font-size: 1rem;
    background-color: var(--surface-color);
    color: var(--text-color);
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.75rem center;
    background-repeat: no-repeat;
    background-size: 1rem;
    padding-right: 2.5rem;
}

.filter-container select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1), 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* Screen reader only class */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* ===== Cards Container ===== */
#cardsContainer {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-xl);
    width: 100%;
}

/* ===== Card Styles ===== */
.card {
    background-color: var(--surface-color);
    border-radius: var(--border-radius);
    padding: var(--spacing-2xl);
    box-shadow: var(--shadow);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.card:hover {
    transform: translateY(-6px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-color);
}

.card:hover::before {
    opacity: 1;
}

.card-header {
    margin-bottom: var(--spacing-lg);
}

.card-title {
    font-size: 1.375rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: var(--spacing-sm);
    line-height: 1.3;
    letter-spacing: -0.01em;
}

.card-description {
    color: var(--text-light);
    font-size: 1rem;
    margin-bottom: var(--spacing-lg);
    line-height: 1.6;
    font-weight: 400;
}

/* ===== Category Badge Styles ===== */
.category-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.875rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.025em;
    margin-bottom: var(--spacing-lg);
    margin-right: var(--spacing-sm);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    transition: all 0.2s ease;
}

.category-badge:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
}

.category-badge.primary {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
}

.category-badge.secondary {
    background: linear-gradient(135deg, var(--secondary-color), #3b82f6);
    color: white;
}

.category-badge.accent {
    background: linear-gradient(135deg, var(--accent-color), var(--success-color));
    color: white;
}

/* ===== Collapsible Steps Styles ===== */
.steps-container {
    margin-top: var(--spacing-md);
}

.steps-toggle-btn {
    background: linear-gradient(135deg, var(--accent-color), var(--success-color));
    color: white;
    border: none;
    padding: var(--spacing-md) var(--spacing-lg);
    border-radius: var(--border-radius-sm);
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
    text-align: center;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
    position: relative;
    overflow: hidden;
}

.steps-toggle-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
}

.steps-toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.08);
}

.steps-toggle-btn:hover::before {
    left: 100%;
}

.steps-toggle-btn:active {
    transform: translateY(0);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
}


/* ===== Card Footer ===== */
.card-footer {
    margin-top: auto;
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--border-color);
    font-size: 0.875rem;
}

.card-footer p {
    margin-bottom: var(--spacing-xs);
    color: var(--text-muted);
    font-weight: 500;
}

.card-footer strong {
    color: var(--text-light);
    font-weight: 600;
}

/* ===== Modal/Popup Styles ===== */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-overlay.show {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background: var(--surface-color);
    border-radius: var(--border-radius);
    box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1), 0 10px 10px rgba(0, 0, 0, 0.04);
    width: 70vw;
    max-width: 800px;
    min-width: 300px;
    max-height: 80vh;
    overflow-y: auto;
    transform: scale(0.95) translateY(20px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border: 1px solid var(--border-color);
}

.modal-overlay.show .modal-content {
    transform: scale(1) translateY(0);
}

.modal-header {
    padding: var(--spacing-2xl);
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border-radius: var(--border-radius) var(--border-radius) 0 0;
    position: relative !important;
    min-height: 80px;
}

.modal-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.08)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.1;
    border-radius: inherit;
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0;
    position: relative;
    z-index: 1;
    letter-spacing: -0.025em;
}

.modal-close {
    position: absolute !important;
    top: var(--spacing-lg) !important;
    right: var(--spacing-lg) !important;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    font-weight: 600;
    transition: all 0.2s ease;
    z-index: 2;
}

.modal-close:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.modal-body {
    padding: var(--spacing-2xl);
}

.modal-steps {
    list-style: none;
    padding: 0;
    margin: 0;
    counter-reset: step-counter;
}

.modal-steps li {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
    padding: var(--spacing-lg);
    background: var(--bg-color);
    border-radius: var(--border-radius-sm);
    border-left: 4px solid var(--accent-color);
    position: relative;
    transition: all 0.2s ease;
}

.modal-steps li:hover {
    background: rgba(5, 150, 105, 0.05);
    transform: translateX(4px);
}

.modal-steps li::before {
    content: counter(step-counter);
    counter-increment: step-counter;
    background: linear-gradient(135deg, var(--accent-color), var(--success-color));
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    font-weight: 700;
    flex-shrink: 0;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.modal-steps li:last-child {
    margin-bottom: 0;
}

.step-content {
    flex: 1;
    line-height: 1.6;
    color: var(--text-color);
    font-size: 1rem;
}

/* ===== Responsive Modal ===== */
@media (max-width: 768px) {
    .modal-content {
        width: 90vw;
        max-width: none;
        margin: var(--spacing-lg);
    }

    .modal-header {
        padding: var(--spacing-xl);
        min-height: 70px;
    }

    .modal-close {
        top: var(--spacing-md) !important;
        right: var(--spacing-md) !important;
        width: 36px;
        height: 36px;
        font-size: 1.1rem;
    }

    .modal-title {
        font-size: 1.25rem;
    }

    .modal-body {
        padding: var(--spacing-xl);
    }

    .modal-steps li {
        gap: var(--spacing-md);
        padding: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
    }

    .modal-steps li::before {
        width: 36px;
        height: 36px;
        font-size: 0.9rem;
    }
}

@media (max-width: 480px) {
    .modal-content {
        width: 95vw;
        margin: var(--spacing-md);
    }

    .modal-header {
        padding: var(--spacing-lg);
        min-height: 60px;
    }

    .modal-close {
        top: var(--spacing-sm) !important;
        right: var(--spacing-sm) !important;
        width: 32px;
        height: 32px;
        font-size: 1rem;
    }

    .modal-title {
        font-size: 1.125rem;
    }

    .modal-body {
        padding: var(--spacing-lg);
    }

    .modal-steps li {
        gap: var(--spacing-sm);
        padding: var(--spacing-sm);
        margin-bottom: var(--spacing-md);
    }

    .modal-steps li::before {
        width: 32px;
        height: 32px;
        font-size: 0.8rem;
    }
}

/* ===== Responsive Design ===== */
/* Tablet and larger screens */
@media (min-width: 768px) {
    body {
        padding: var(--spacing-lg);
    }

    header h1 {
        font-size: 2rem;
    }

    .filters {
        flex-direction: row;
        align-items: flex-end;
    }

    .search-container {
        flex: 2;
    }

    .filter-container {
        flex: 1;
    }

    #cardsContainer {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-lg);
    }
}

/* Desktop screens */
@media (min-width: 1024px) {
    body {
        max-width: 1200px;
        margin: 0 auto;
        padding: var(--spacing-xl);
    }

    header {
        padding: var(--spacing-xl) var(--spacing-xl);
    }

    header h1 {
        font-size: 2.25rem;
    }

    #cardsContainer {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--spacing-xl);
    }

    .card {
        padding: var(--spacing-xl);
    }
}

/* Large desktop screens */
@media (min-width: 1440px) {
    #cardsContainer {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--spacing-xl);
    }
}
/* ===== Most Viewed List Styling ===== */
.list-view-container { margin-bottom: var(--spacing-xl); }
.list-view-container h3 { font-size:1.25rem; color: var(--primary-color); margin-bottom: var(--spacing-md); }
.list-view { list-style:none; padding:0; margin:0; display:grid; gap: var(--spacing-sm); }
.list-view li {
  background-color: var(--surface-color);
  border-radius: var(--border-radius);
  padding: var(--spacing-md);
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
  border:1px solid var(--border-color);
  font-weight:500;
}
.list-view li:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
  border:1px solid var(--primary-color);
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
  color:white;
}
/* ===== Add Issue Modal Form Styling ===== */
#addIssueForm {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

#addIssueForm label {
  font-weight: 600;
  margin-bottom: var(--spacing-xs);
  color: var(--text-color);
}

#addIssueForm input[type="text"],
#addIssueForm input[type="number"],
#addIssueForm textarea {
  width: 100%;
  padding: var(--spacing-lg);
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius-sm);
  font-size: 1rem;
  background-color: var(--surface-color);
  color: var(--text-color);
  transition: all 0.3s ease;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  resize: vertical;
}

#addIssueForm input[type="text"]:focus,
#addIssueForm input[type="number"]:focus,
#addIssueForm textarea:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1), 0 1px 3px rgba(0,0,0,0.1);
}

#addIssueForm textarea {
  min-height: 80px;
}

#addIssueForm button[type="submit"] {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
  color: white;
  font-weight: 600;
  border: none;
  border-radius: var(--border-radius);
  padding: var(--spacing-md);
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: var(--shadow);
}

#addIssueForm button[type="submit"]:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
}
#addIssueMessage {
  color: var(--accent-color);
  font-weight: 600;
  margin-top: var(--spacing-sm);
}


  </style>
</head>
<body>
  <header>
    <h1>Village Enterprise IT Tips</h1>
    <p class="description">Quick IT troubleshooting tips for staff and volunteers.</p>
  </header>

  <div class="filters">
    <div class="search-container">
      <input type="search" id="searchInput" placeholder="Search tips...">
    </div>
    <div class="filter-container">
      <select id="categoryFilter">
        <option value="">All Categories</option>
      </select>
    </div>
  </div>
  <!-- ===== Admin Add Issue Button & Modal ===== -->
<div id="adminSection" style="display:none; margin-bottom: var(--spacing-xl);">
  <button id="addIssueBtn" class="steps-toggle-btn">Add Issue</button>
</div>

<!-- Modal for adding issue -->
<div class="modal-overlay" id="addIssueModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeAddIssueModal()">×</button>
    <div class="modal-header">
      <h2 class="modal-title">Add New Issue</h2>
    </div>
    <div class="modal-body">
      <form id="addIssueForm">
        <div>
          <label>Category</label>
          <input type="text" name="Category" required>
        </div>
        <div>
          <label>Issue</label>
          <input type="text" name="Issue" required>
        </div>
        <div>
          <label>Description</label>
          <textarea name="Description" required></textarea>
        </div>
        <div>
          <label>Steps (one per line)</label>
          <textarea name="Steps"></textarea>
        </div>
        <div>
          <label>Created By (Your Name)</label>
          <input type="text" name="CreatedBy" required>
        </div>
        <div>
          <label>Views</label>
          <input type="number" name="Views" value="0" min="0">
        </div>
        <button type="submit" class="steps-toggle-btn" style="margin-top: var(--spacing-md);">Submit</button>
      </form>
      <p id="addIssueMessage" style="margin-top: var(--spacing-md); font-weight:600;"></p>
    </div>
  </div>
</div>

  <!-- ===== List View: Most Viewed Issues by Category ===== -->
<div id="listViewContainer" class="list-view-container">
  <h3>Most Viewed Issues</h3>
  <ul id="issueList" class="list-view"></ul>
</div>


  <div id="cardsContainer"></div>

  <!-- Modal -->
  <div class="modal-overlay" id="stepsModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeStepsModal()">×</button>
      <div class="modal-header" id="modalTitle"></div>
      <ul class="modal-steps" id="modalStepsList"></ul>
    </div>
  </div>

  <script>
    const ADMIN_EMAILS = ['josephm@villageenterprise.org']; // Replace with real admin emails

function checkAdminAccess() {
  google.script.run.withSuccessHandler(userEmail => {
    if (ADMIN_EMAILS.includes(userEmail)) {
      document.getElementById('adminSection').style.display = 'block';
      document.getElementById('addIssueBtn').addEventListener('click', openAddIssueModal);
    }
  }).getUserEmail();
}
    let allTips = [];
    let filteredTips = [];

    function init() {
      const container = document.getElementById('cardsContainer');
      container.innerHTML = `<p>Loading tips...</p>`;
      google.script.run
        .withSuccessHandler(data => {
          allTips = data.map(tip => ({
            ...tip,
            Steps: tip.Steps ? tip.Steps.split(/\r?\n/) : [],
            Timestamp: tip.Timestamp ? new Date(tip.Timestamp) : null
          }));
          filteredTips = [...allTips];
          populateCategoryFilter();
          renderListView();  // <-- Add this line
          renderCards();
          initializeEventListeners();
          checkAdminAccess();

        })
        .withFailureHandler(err => {
          container.innerHTML = `<p style="color:red;">Error loading tips: ${err.message}</p>`;
        })
        .getTips();
    }

    function populateCategoryFilter() {
      const select = document.getElementById('categoryFilter');
      const categories = Array.from(new Set(allTips.map(t => t.Category).filter(c => c))).sort();
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option);
      });
      select.addEventListener('change', applyFilters);
    }

    function applyFilters() {
      const searchQuery = document.getElementById('searchInput').value.toLowerCase();
      const category = document.getElementById('categoryFilter').value;
      filteredTips = allTips.filter(tip => {
        const matchesSearch =
          tip.Issue.toLowerCase().includes(searchQuery) ||
          (tip.Description && tip.Description.toLowerCase().includes(searchQuery));
        const matchesCategory = !category || tip.Category === category;
        return matchesSearch && matchesCategory;
      });
      renderCards();
    }

    function renderCards() {
      const container = document.getElementById('cardsContainer');
      container.innerHTML = '';
      if (filteredTips.length === 0) {
        container.innerHTML = `<p>No tips found.</p>`;
        return;
      }
      filteredTips.forEach(tip => {
        const card = document.createElement('div'); card.className = 'card';
        const badge = document.createElement('div'); badge.className = 'category-badge'; badge.textContent = tip.Category || 'General';
        const title = document.createElement('h3'); title.className='card-title'; title.textContent=tip.Issue;
        const desc = document.createElement('p'); desc.className='card-description'; desc.textContent=tip.Description || '';
        const btn = document.createElement('button'); btn.className='steps-toggle-btn'; btn.textContent='View Steps';
        btn.addEventListener('click',()=>openStepsModal(tip));
        const footer = document.createElement('div'); footer.className='card-footer';
        if(tip.CreatedBy){const p=document.createElement('p'); p.innerHTML=`Created by: <strong>${tip.CreatedBy}</strong>`; footer.appendChild(p);}
        if(tip.Timestamp){const p2=document.createElement('p'); p2.innerHTML=`Created on: <strong>${formatDate(tip.Timestamp)}</strong>`; footer.appendChild(p2);}
        card.appendChild(badge); card.appendChild(title); card.appendChild(desc); card.appendChild(btn); card.appendChild(footer);
        container.appendChild(card);
      });
    }



    function openStepsModal(tip){
      const modal=document.getElementById('stepsModal');
      const title=document.getElementById('modalTitle');
      const stepsList=document.getElementById('modalStepsList');
      title.textContent=tip.Issue;
      stepsList.innerHTML='';
      if(tip.Steps.length===0){ const li=document.createElement('li'); li.textContent='No steps provided.'; stepsList.appendChild(li); }
      else tip.Steps.forEach(step=>{const li=document.createElement('li'); const div=document.createElement('div'); div.className='step-content'; div.textContent=step; li.appendChild(div); stepsList.appendChild(li); });
      modal.classList.add('show');
    }

    function closeStepsModal(){ document.getElementById('stepsModal').classList.remove('show'); }
    document.getElementById('stepsModal').addEventListener('click', e=>{ if(e.target===e.currentTarget) closeStepsModal(); });

    function formatDate(date){ return date.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'}); }

    function initializeEventListeners(){ document.getElementById('searchInput').addEventListener('input', applyFilters); }
    function openAddIssueModal() {
  document.getElementById('addIssueModal').classList.add('show');
}

function closeAddIssueModal() {
  document.getElementById('addIssueModal').classList.remove('show');
  document.getElementById('addIssueForm').reset();
  document.getElementById('addIssueMessage').textContent = '';
  
}

// Close modal if clicked outside
document.getElementById('addIssueModal').addEventListener('click', e => {
  if (e.target === e.currentTarget) closeAddIssueModal();
});
document.getElementById('addIssueForm').addEventListener('submit', e => {
  e.preventDefault();
  const form = e.target;
  const formData = Object.fromEntries(new FormData(form).entries());

  // Convert Views to number
  formData.Views = Number(formData.Views || 0);

  google.script.run
    .withSuccessHandler(tip => {
      document.getElementById('addIssueMessage').textContent = 'Issue added successfully!';
      allTips.push({
        ...tip,
        Steps: tip.Steps ? tip.Steps.split(/\r?\n/) : [],
        Timestamp: tip.Timestamp ? new Date(tip.Timestamp) : null
      });
      renderCards();
      renderListView();
      setTimeout(closeAddIssueModal, 1500); // close modal after 1.5s
    })
    .withFailureHandler(err => {
      document.getElementById('addIssueMessage').textContent = 'Error: ' + err.message;
    })
    .addTip(formData);
});

    /* ===== Render Most Viewed List ===== */
/* ===== Render Most Viewed List (Top 5 Only, Non-zero Views) ===== */
function renderListView() {
  const listContainer = document.getElementById('issueList');
  listContainer.innerHTML = '';

  // Filter tips with Views > 0 and sort descending
  const sortedTips = allTips
    .filter(tip => Number(tip.Views || 0) > 0)
    .sort((a, b) => Number(b.Views) - Number(a.Views))
    .slice(0, 5); // Only top 5

  // If no tips have views, hide the list container
  const listWrapper = document.getElementById('listViewContainer');
  if (sortedTips.length === 0) {
    listWrapper.style.display = 'none';
    return;
  } else {
    listWrapper.style.display = 'block';
  }

  // "Show All" option
  const allLi = document.createElement('li');
  allLi.textContent = 'Show All';
  allLi.onclick = () => { filteredTips = [...allTips]; renderCards(); };
  listContainer.appendChild(allLi);

  // Add each tip
  sortedTips.forEach(tip => {
    const li = document.createElement('li');
    li.textContent = `${tip.Issue} (${tip.Views} views) - ${tip.Category || 'General'}`;
    li.onclick = () => filterCardById(tip.ID);
    listContainer.appendChild(li);
  });
}


/* ===== Filter cards by specific tip ID ===== */
function filterCardById(id) {
  filteredTips = allTips.filter(tip => tip.ID === id);
  renderCards();
}


    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
